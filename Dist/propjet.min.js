/*
 propjet.js 0.6
 (c) 2015 Artem Avramenko. https://github.com/ArtemAvramenko/propjet.js
 License: MIT
*/
this.propjet=(function(){var b;if([].forEach){b=function(h,g){return h.forEach(g)}}else{b=function(k,g){var j=k.length;for(var h=0;h<j;h++){g(k[h],h)}}}var a;if(!(Object.defineProperty&&Object.getOwnPropertyNames&&Object.getOwnPropertyDescriptor)){a=function(){throw new Error("This browser does not support property creation. Instead, use function mode.")}}var c;var f;if(a){if(!(function(){for(var g in {propertyIsEnumerable:null}){return g}})()){c=function(g){var h=g.propertyIsEnumerable;return h&&h.__prop__ver__};f=function(g,i){if(!i){var h=g.propertyIsEnumerable;g.propertyIsEnumerable=function(j){return h(j)}}g.propertyIsEnumerable.__prop__ver__=i}}}else{f=function(g,h){if(!h){Object.defineProperty(g,"__prop__ver__",{value:0,configurable:true,writable:true})}else{g.__prop__ver__=h}}}if(!c){c=function(g){return g.__prop__ver__}}if(!f){f=function(g,h){return g.__prop__ver__=h}}var d=0;var e=(function(j,k){var i;if(j&&!k){if(a){a()}b(Object.getOwnPropertyNames(j),function(m){var l=Object.getOwnPropertyDescriptor(j,m);if(!l||!l.get){i=j[m];if(i!=null&&i.__prop__unready__){h(m,i)}}});return}i={};i.__prop__unready__=true;var g={require:function(){var m=[];for(var l=0;l<arguments.length;l++){m[l-0]=arguments[l]}i.src=m;return g},"default":function(l){i.init=l;return g},get:function(l){i.get=l;return g},set:function(l){i.set=l;return g},declare:function(l){if(l){return h(k,i,true)}else{if(k){h(k,i)}else{return i}}}};g.withal=g["with"]=function(l){i.fltr=l;return g};return g;function h(q,l,o){delete l.__prop__unready__;if(o){var n=function(s){if(arguments.length===0){return p()}r(s)};if(q){j[q]=n}return n}if(a){a()}Object.defineProperty(j,q,{configurable:true,enumerable:true,get:p,set:r});function m(s){if(s===undefined){return 1}if(s==null){return 2}if(typeof s==="number"&&isNaN(s)){return 3}return 0}function p(){if(l.lvl){if(l.lvl===d){return l.res}throw new Error("Circular dependency detected")}d++;try{l.lvl=d;if(!l.get){if(l.init){l.res=l.init.call(j);delete l.init}return l.res}var u=l.vals&&l.src&&l.vals.length===l.src.length;if(!u){l.vals=undefined}var s;if(l.src){s=[];b(l.src,function(B,x){var z=l.vals!=null?l.vals[x]:undefined;var w=B.call(j,z!=null?z.val:undefined);s[x]=w;if(u){var A=m(z.val);var y=m(w);if(A){u=A===y}else{u=!y&&z.val===w&&z.ver===c(w)&&z.len===w.length}}})}if(!u){var v;if(s){v=[];b(s,function(w,x){v[x]={val:w,ver:w!=null?c(w):undefined,len:w!=null?w.length:undefined}})}else{s=[]}var t=l.get.apply(j,s);if(l.fltr){t=l.fltr.call(j,t,l.res)}l.vals=v;l.res=t}return l.res}finally{d--;delete l.lvl}}function r(s){if(l.lvl){throw new Error("Recursive property write")}d++;try{l.lvl=-1;if(s!=null&&s.__prop__unready__){l=s;delete l.__prop__unready__;return}if(l.fltr){s=l.fltr.call(j,s,l.res)}if(l.set){l.set.call(j,s)}else{if(l.get){throw new Error("Attempt to write readonly property")}}if(!l.get){l.res=s;l.init=undefined}}finally{d--;delete l.lvl}}}});e.invalidate=function(h){if(h==null){return}var i=typeof h;if(i!=="object"&&i!=="function"){return}var j=c(h);var g=0;if(j!=null){g=j+1;if(g===j){g=1}}f(h,g)};return e})();